import './App.css';
import './index.css';
import { useState, useEffect } from 'react';

function App() {
  // State for all companies
  const [allCompanies, setAllCompanies] = useState([]);
  const [filteredCompanies, setFilteredCompanies] = useState([]);
  const [loading, setLoading] = useState(true);
  const [currentPage, setCurrentPage] = useState(1);
  const [itemsPerPage] = useState(50);
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedSector, setSelectedSector] = useState('All');
  const [selectedIndex, setSelectedIndex] = useState('All');
  const [marketStats, setMarketStats] = useState({});
  
  // Indian market indices
  const indices = [
    'Nifty 50', 'Nifty Next 50', 'Nifty 100', 'Nifty 200', 'Nifty 500',
    'Nifty Midcap 100', 'Nifty Smallcap 100', 'Nifty Bank', 'Nifty IT',
    'Nifty Auto', 'Nifty Pharma', 'Nifty FMCG', 'Nifty Metal', 'Nifty Realty',
    'Nifty Energy', 'Nifty PSU Bank', 'Nifty Private Bank', 'Nifty Healthcare',
    'Sensex', 'BSE SmallCap', 'BSE MidCap', 'BSE LargeCap'
  ];
  
  // All sectors in Indian market
  const sectors = [
    'All', 'Banking', 'IT', 'Energy', 'FMCG', 'Automobile', 'Pharmaceuticals',
    'Telecom', 'Real Estate', 'Metals', 'Cement', 'Chemicals', 'Construction',
    'Consumer Durables', 'Finance', 'Industrial Manufacturing', 'Media',
    'Oil & Gas', 'Power', 'Retail', 'Textiles', 'Transportation', 'Miscellaneous'
  ];

  // Market cap categories
  const marketCapCategories = [
    { label: 'Large Cap (>‚Çπ20,000 Cr)', min: 20000 },
    { label: 'Mid Cap (‚Çπ5,000-20,000 Cr)', min: 5000, max: 20000 },
    { label: 'Small Cap (<‚Çπ5,000 Cr)', max: 5000 },
    { label: 'Micro Cap (<‚Çπ500 Cr)', max: 500 }
  ];

  // Initialize with sample data (in real app, fetch from API)
  useEffect(() => {
    fetchAllCompanies();
    calculateMarketStats();
  }, []);

  // Apply filters whenever search/filters change
  useEffect(() => {
    filterCompanies();
  }, [searchTerm, selectedSector, selectedIndex, allCompanies]);

  const fetchAllCompanies = async () => {
    // In production, this would fetch from your backend API
    // For demo, generating 1000+ sample companies
    
    const generateCompanies = () => {
      const companies = [];
      const companyNames = [
        'Reliance', 'Tata', 'Adani', 'Mahindra', 'Birla', 'Godrej', 'Wipro', 'Infosys',
        'HDFC', 'ICICI', 'Axis', 'Kotak', 'State Bank', 'Bajaj', 'Hero', 'Maruti',
        'Asian Paints', 'Hindustan Unilever', 'ITC', 'Nestle', 'Britannia', 'Dabur'
      ];
      
      const industries = ['Industries', 'Limited', 'Corporation', 'Enterprises', 'Group', 'Ltd'];
      
      for (let i = 0; i < 1500; i++) {
        const name = `${companyNames[i % companyNames.length]} ${industries[i % industries.length]} ${i > 1000 ? `(${Math.floor(i/100)}-Series)` : ''}`;
        const sector = sectors[Math.floor(Math.random() * (sectors.length - 1)) + 1];
        const marketCap = Math.random() * 100000 + 500;
        const price = Math.random() * 10000 + 100;
        const change = (Math.random() * 10 - 5).toFixed(2);
        
        companies.push({
          id: i + 1,
          symbol: generateSymbol(name, i),
          name: name,
          sector: sector,
          marketCap: marketCap,
          price: price.toFixed(2),
          change: parseFloat(change),
          changePercent: ((change / price) * 100).toFixed(2),
          volume: Math.floor(Math.random() * 10000000),
          index: indices[Math.floor(Math.random() * indices.length)],
          peRatio: (Math.random() * 50 + 10).toFixed(1),
          dividendYield: (Math.random() * 5).toFixed(2),
          weekHigh: (price * 1.2).toFixed(2),
          weekLow: (price * 0.8).toFixed(2)
        });
      }
      return companies;
    };

    const generateSymbol = (name, index) => {
      const parts = name.split(' ');
      const symbol = parts[0].toUpperCase().substring(0, 4) + 
                    (parts[1] ? parts[1].substring(0, 1) : '') + 
                    (index % 100);
      return symbol + '.NS';
    };

    setAllCompanies(generateCompanies());
    setLoading(false);
  };

  const filterCompanies = () => {
    let filtered = [...allCompanies];
    
    // Apply search filter
    if (searchTerm) {
      const term = searchTerm.toLowerCase();
      filtered = filtered.filter(company => 
        company.symbol.toLowerCase().includes(term) ||
        company.name.toLowerCase().includes(term) ||
        company.sector.toLowerCase().includes(term)
      );
    }
    
    // Apply sector filter
    if (selectedSector !== 'All') {
      filtered = filtered.filter(company => company.sector === selectedSector);
    }
    
    // Apply index filter
    if (selectedIndex !== 'All') {
      filtered = filtered.filter(company => company.index === selectedIndex);
    }
    
    setFilteredCompanies(filtered);
    setCurrentPage(1); // Reset to first page on filter
  };

  const calculateMarketStats = () => {
    // Calculate market statistics
    const stats = {
      totalCompanies: 5246,
      totalMarketCap: '‚Çπ350,00,000 Cr',
      advances: 3250,
      declines: 1580,
      unchanged: 416,
      volume: '‚Çπ45,230 Cr',
      fiiInflow: '+‚Çπ1,250 Cr',
      diiInflow: '+‚Çπ680 Cr'
    };
    setMarketStats(stats);
  };

  // Pagination
  const indexOfLastItem = currentPage * itemsPerPage;
  const indexOfFirstItem = indexOfLastItem - itemsPerPage;
  const currentCompanies = filteredCompanies;
  const totalPages = Math.ceil(filteredCompanies.length / itemsPerPage);

  // Handle company selection for details
  const [selectedCompany, setSelectedCompany] = useState(null);

  const handleCompanySelect = (company) => {
    setSelectedCompany(company);
  };

  const getMarketCapCategory = (marketCap) => {
    if (marketCap > 20000) return 'Large Cap';
    if (marketCap > 5000) return 'Mid Cap';
    if (marketCap > 500) return 'Small Cap';
    return 'Micro Cap';
  };

  return (
    <div className="App">
      {/* Market Header */}
      <div className="market-header">
        <div className="market-title">
          <h1>üìà All India Stock Market</h1>
          <p className="subtitle">Complete database of {marketStats.totalCompanies} listed companies | Real-time tracking</p>
        </div>
        <div className="market-summary">
          <div className="summary-item">
            <span className="label">Total Market Cap</span>
            <span className="value">{marketStats.totalMarketCap}</span>
          </div>
          <div className="summary-item">
            <span className="label">Advances/Declines</span>
            <span className="value positive">{marketStats.advances}</span>
            <span className="divider">/</span>
            <span className="value negative">{marketStats.declines}</span>
          </div>
        </div>
      </div>

      {/* Main Navigation */}
      <nav className="main-nav">
        <div className="nav-section">
          <h3>Market Segments</h3>
          <div className="segments">
            <button className="segment-btn active">All Stocks</button>
            <button className="segment-btn">Large Cap</button>
            <button className="segment-btn">Mid Cap</button>
            <button className="segment-btn">Small Cap</button>
            <button className="segment-btn">IPO Watch</button>
            <button className="segment-btn">Volume Gainers</button>
          </div>
        </div>
        <div className="market-actions">
          <button className="action-btn">üìä Market Depth</button>
          <button className="action-btn">üìà Advanced Charts</button>
          <button className="action-btn">ü§ñ AI Screener</button>
          <button className="action-btn primary">üíæ Export Data</button>
        </div>
      </nav>

      {/* Main Container */}
      <div className="container comprehensive">
        {/* Left Column - Filters & Search */}
        <div className="filters-sidebar">
          {/* Universal Search */}
          <div className="filter-section">
            <h4>üîç Search All Companies</h4>
            <input
              type="text"
              className="universal-search"
              placeholder="Search by name, symbol, or sector..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
            <div className="search-stats">
              Found {filteredCompanies.length} companies
            </div>
          </div>

          {/* Sector Filter */}
          <div className="filter-section">
            <h4>üè¢ Sector</h4>
            <div className="sector-filters">
              {sectors.map(sector => (
                <button
                  key={sector}
                  className={`sector-btn ${selectedSector === sector ? 'active' : ''}`}
                  onClick={() => setSelectedSector(sector)}
                >
                  {sector}
                  <span className="count">
                    {allCompanies.filter(c => c.sector === sector).length}
                  </span>
                </button>
              ))}
            </div>
          </div>

          {/* Index Filter */}
          <div className="filter-section">
            <h4>üìä Index</h4>
            <select 
              className="index-select"
              value={selectedIndex}
              onChange={(e) => setSelectedIndex(e.target.value)}
            >
              <option value="All">All Indices</option>
              {indices.map(index => (
                <option key={index} value={index}>{index}</option>
              ))}
            </select>
          </div>

          {/* Market Cap Filter */}
          <div className="filter-section">
            <h4>üí∞ Market Cap</h4>
            <div className="cap-filters">
              {marketCapCategories.map(category => (
                <button key={category.label} className="cap-btn">
                  {category.label}
                </button>
              ))}
            </div>
          </div>

          {/* Price Range Filter */}
          <div className="filter-section">
            <h4>üíµ Price Range</h4>
            <div className="price-slider">
              <input type="range" min="0" max="10000" className="slider" />
              <div className="price-labels">
                <span>‚Çπ0</span>
                <span>‚Çπ10,000+</span>
              </div>
            </div>
          </div>

          {/* Quick Stats */}
          <div className="filter-section stats">
            <h4>üìà Quick Stats</h4>
            <div className="stat-items">
              <div className="stat-item">
                <span className="stat-label">FII Activity</span>
                <span className="stat-value positive">{marketStats.fiiInflow}</span>
              </div>
              <div className="stat-item">
                <span className="stat-label">DII Activity</span>
                <span className="stat-value positive">{marketStats.diiInflow}</span>
              </div>
              <div className="stat-item">
                <span className="stat-label">Total Volume</span>
                <span className="stat-value">{marketStats.volume}</span>
              </div>
            </div>
          </div>
        </div>

        {/* Middle Column - Companies Table */}
        <div className="companies-main">
          {/* Table Header */}
          <div className="table-header">
            <div className="header-left">
              <h3>üìã All Listed Companies</h3>
              <div className="table-actions">
                <button className="table-btn">Sort: Market Cap</button>
                <button className="table-btn">Columns</button>
                <button className="table-btn">Refresh</button>
              </div>
            </div>
            <div className="header-right">
              <span className="showing">
                Showing {indexOfFirstItem + 1}-{Math.min(indexOfLastItem, filteredCompanies.length)} of {filteredCompanies.length}
              </span>
            </div>
          </div>

          {/* Companies Table */}
          {loading ? (
            <div className="loading-table">
              <div className="spinner"></div>
              <p>Loading database of {marketStats.totalCompanies} companies...</p>
            </div>
          ) : (
            <>
              <div className="companies-table-container">
                <table className="companies-table">
                  <thead>
                    <tr>
                      <th className="sticky-col">Symbol</th>
                      <th>Company Name</th>
                      <th>Sector</th>
                      <th>Price (‚Çπ)</th>
                      <th>Change %</th>
                      <th>Market Cap</th>
                      <th>P/E</th>
                      <th>Volume</th>
                      <th>52W High</th>
                      <th>52W Low</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {currentCompanies.map(company => (
                      <tr 
                        key={company.id}
                        className={selectedCompany?.id === company.id ? 'selected' : ''}
                        onClick={() => handleCompanySelect(company)}
                      >
                        <td className="sticky-col symbol-cell">
                          <strong>{company.symbol}</strong>
                          <small>{getMarketCapCategory(company.marketCap)}</small>
                        </td>
                        <td className="company-name">
                          {company.name}
                          <div className="company-index">{company.index}</div>
                        </td>
                        <td className="sector-cell">{company.sector}</td>
                        <td className="price-cell">‚Çπ{company.price}</td>
                        <td className={`change-cell ${company.change >= 0 ? 'positive' : 'negative'}`}>
                          {company.change >= 0 ? '‚ñ≤' : '‚ñº'} {Math.abs(company.changePercent)}%
                        </td>
                        <td className="mcap-cell">
                          ‚Çπ{(company.marketCap / 1000).toFixed(1)}K Cr
                        </td>
                        <td className="pe-cell">{company.peRatio}</td>
                        <td className="volume-cell">
                          {(company.volume / 1000000).toFixed(1)}M
                        </td>
                        <td className="high-cell">‚Çπ{company.weekHigh}</td>
                        <td className="low-cell">‚Çπ{company.weekLow}</td>
                        <td className="actions-cell">
                          <button className="action-small">View</button>
                          <button className="action-small predict">Predict</button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {/* Pagination */}
              <div className="pagination">
                <button 
                  className="page-btn" 
                  onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}
                  disabled={currentPage === 1}
                >
                  ‚Üê Previous
                </button>
                
                <div className="page-numbers">
                  {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {
                    let pageNum;
                    if (totalPages <= 5) {
                      pageNum = i + 1;
                    } else if (currentPage <= 3) {
                      pageNum = i + 1;
                    } else if (currentPage >= totalPages - 2) {
                      pageNum = totalPages - 4 + i;
                    } else {
                      pageNum = currentPage - 2 + i;
                    }
                    
                    return (
                      <button
                        key={pageNum}
                        className={`page-number ${currentPage === pageNum ? 'active' : ''}`}
                        onClick={() => setCurrentPage(pageNum)}
                      >
                        {pageNum}
                      </button>
                    );
                  })}
                  
                  {totalPages > 5 && currentPage < totalPages - 2 && (
                    <>
                      <span className="page-dots">...</span>
                      <button
                        className="page-number"
                        onClick={() => setCurrentPage(totalPages)}
                      >
                        {totalPages}
                      </button>
                    </>
                  )}
                </div>
                
                <button 
                  className="page-btn"
                  onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}
                  disabled={currentPage === totalPages}
                >
                  Next ‚Üí
                </button>
                
                <div className="page-size">
                  <span>Show:</span>
                  <select 
                    value={itemsPerPage}
                    onChange={(e) => {
                      // In real app, this would update itemsPerPage
                      setCurrentPage(1);
                    }}
                  >
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="200">200</option>
                  </select>
                </div>
              </div>
            </>
          )}

          {/* Quick View Stats */}
          <div className="quick-stats">
            <div className="stat-card">
              <h4>Market Breadth</h4>
              <div className="breadth-bar">
                <div 
                  className="breadth-advances" 
                  style={{ width: `${(marketStats.advances / marketStats.totalCompanies * 100).toFixed(1)}%` }}
                ></div>
              </div>
              <div className="breadth-numbers">
                <span className="advances">{marketStats.advances} Advances</span>
                <span className="declines">{marketStats.declines} Declines</span>
              </div>
            </div>
            
            <div className="stat-card">
              <h4>Sector Distribution</h4>
              <div className="sector-distribution">
                {sectors.slice(1, 6).map(sector => {
                  const count = allCompanies.filter(c => c.sector === sector).length;
                  const percent = (count / allCompanies.length * 100).toFixed(1);
                  return (
                    <div key={sector} className="sector-dist-item">
                      <span className="sector-name">{sector}</span>
                      <div className="sector-bar">
                        <div 
                          className="sector-fill" 
                          style={{ width: `${percent}%` }}
                        ></div>
                      </div>
                      <span className="sector-percent">{percent}%</span>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        </div>

        {/* Right Column - Selected Company Details */}
        <div className="details-sidebar">
          {selectedCompany ? (
            <div className="company-details">
              <div className="details-header">
                <h3>{selectedCompany.symbol}</h3>
                <h4>{selectedCompany.name}</h4>
                <div className="company-tags">
                  <span className="tag sector">{selectedCompany.sector}</span>
                  <span className="tag index">{selectedCompany.index}</span>
                  <span className="tag cap">{getMarketCapCategory(selectedCompany.marketCap)}</span>
                </div>
              </div>

              <div className="price-details">
                <div className="current-price-section">
                  <div className="price-label">Current Price</div>
                  <div className="current-price">‚Çπ{selectedCompany.price}</div>
                  <div className={`price-change ${selectedCompany.change >= 0 ? 'positive' : 'negative'}`}>
                    {selectedCompany.change >= 0 ? '‚ñ≤' : '‚ñº'} ‚Çπ{Math.abs(selectedCompany.change).toFixed(2)} ({Math.abs(selectedCompany.changePercent)}%)
                  </div>
                </div>

                <div className="price-stats">
                  <div className="stat-row">
                    <span className="stat-label">Day Range</span>
                    <span className="stat-value">‚Çπ{selectedCompany.weekLow} - ‚Çπ{selectedCompany.weekHigh}</span>
                  </div>
                  <div className="stat-row">
                    <span className="stat-label">Market Cap</span>
                    <span className="stat-value">‚Çπ{(selectedCompany.marketCap / 1000).toFixed(1)}K Cr</span>
                  </div>
                  <div className="stat-row">
                    <span className="stat-label">P/E Ratio</span>
                    <span className="stat-value">{selectedCompany.peRatio}</span>
                  </div>
                  <div className="stat-row">
                    <span className="stat-label">Dividend Yield</span>
                    <span className="stat-value">{selectedCompany.dividendYield}%</span>
                  </div>
                  <div className="stat-row">
                    <span className="stat-label">Volume</span>
                    <span className="stat-value">{(selectedCompany.volume / 1000000).toFixed(1)}M</span>
                  </div>
                </div>
              </div>

              <div className="prediction-section">
                <h4>üìà AI Prediction</h4>
                <div className="prediction-card">
                  <div className="prediction-price">
                    <span className="label">Predicted Price (7D)</span>
                    <span className="value">‚Çπ{(parseFloat(selectedCompany.price) * 1.05).toFixed(2)}</span>
                  </div>
                  <div className="prediction-confidence">
                    <span className="label">Confidence</span>
                    <div className="confidence-meter">
                      <div className="confidence-fill" style={{ width: '85%' }}></div>
                      <span className="confidence-value">85%</span>
                    </div>
                  </div>
                  <div className="prediction-trend">
                    <span className="label">Trend</span>
                    <span className="trend-value positive">Bullish</span>
                  </div>
                  <button className="predict-btn-full">Get Detailed Analysis</button>
                </div>
              </div>

              <div className="similar-companies">
                <h4>Similar Companies</h4>
                <div className="similar-list">
                  {allCompanies
                    .filter(c => c.sector === selectedCompany.sector && c.id !== selectedCompany.id)
                    .slice(0, 5)
                    .map(company => (
                      <div key={company.id} className="similar-item">
                        <span className="sim-symbol">{company.symbol}</span>
                        <span className="sim-price">‚Çπ{company.price}</span>
                        <span className={`sim-change ${company.change >= 0 ? 'positive' : 'negative'}`}>
                          {company.change >= 0 ? '‚ñ≤' : '‚ñº'} {Math.abs(company.changePercent)}%
                        </span>
                      </div>
                    ))}
                </div>
              </div>
            </div>
          ) : (
            <div className="no-selection">
              <div className="placeholder-icon">üìä</div>
              <h4>Select a Company</h4>
              <p>Click on any company from the list to view detailed analysis, predictions, and financial metrics.</p>
              <div className="selection-stats">
                <div className="stat">
                  <div className="stat-number">{marketStats.totalCompanies}</div>
                  <div className="stat-label">Total Companies</div>
                </div>
                <div className="stat">
                  <div className="stat-number">{sectors.length - 1}</div>
                  <div className="stat-label">Sectors</div>
                </div>
                <div className="stat">
                  <div className="stat-number">{indices.length}</div>
                  <div className="stat-label">Indices</div>
                </div>
              </div>
            </div>
          )}
        </div>
      </div>

      {/* Footer */}
      <div className="footer comprehensive">
        <div className="footer-content">
          <div className="footer-section">
            <h5>Data Coverage</h5>
            <p>NSE: 1,951 companies ‚Ä¢ BSE: 5,246 companies ‚Ä¢ Coverage: 100%</p>
          </div>
          <div className="footer-section">
            <h5>Update Frequency</h5>
            <p>Real-time prices ‚Ä¢ EOD updates ‚Ä¢ Quarterly results ‚Ä¢ Live corporate actions</p>
          </div>
          <div className="footer-section">
            <h5>Data Sources</h5>
            <div className="sources">
              <span className="source">NSE Official</span>
              <span className="source">BSE India</span>
              <span className="source">SEBI</span>
              <span className="source">RBI</span>
              <span className="source">Company Filings</span>
            </div>
          </div>
        </div>
        <div className="footer-bottom">
          <p>¬© 2024 All India Stock Market Database ‚Ä¢ Complete coverage of all listed securities</p>
          <p className="disclaimer">
            Data for educational and research purposes. Investment decisions should be based on personal research.
          </p>
        </div>
      </div>
    </div>
  );
}

export default App;
