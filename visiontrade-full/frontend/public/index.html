<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Investment Advisor | Live Market Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #8b5cf6;
            --dark-bg: #0f172a;
            --darker-bg: #0a0e17;
            --card-bg: #1e293b;
            --border: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-tertiary: #64748b;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--darker-bg);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border);
        }

        .logo h1 {
            color: var(--primary);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo p {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 400;
        }

        .live-status {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .live-indicator {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .nav-button {
            background: linear-gradient(135deg, var(--primary), #2563eb);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            font-family: 'Inter', sans-serif;
        }

        .nav-button:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }

        /* Market Stats */
        .market-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--info));
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 34px;
            font-weight: 800;
            font-family: 'Roboto Mono', monospace;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 15px;
            font-family: 'Roboto Mono', monospace;
            font-weight: 600;
        }

        .positive { color: var(--success); }
        .negative { color: var(--danger); }

        .volume-bar {
            height: 4px;
            background: rgba(100, 116, 139, 0.3);
            border-radius: 2px;
            margin-top: 12px;
            overflow: hidden;
        }

        .volume-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--info));
            border-radius: 2px;
            transition: width 0.5s ease-out;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Charts Section */
        .charts-section {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .section-title {
            color: var(--text-primary);
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-box {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            height: 300px;
        }

        .chart-box {
            position: relative;
        }

        .chart-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-secondary);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-status {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 11px;
            color: var(--text-secondary);
            background: rgba(0, 0, 0, 0.3);
            padding: 3px 8px;
            border-radius: 4px;
        }

        .chart-status.live {
            color: var(--success);
        }

        .chart-status.delayed {
            color: var(--warning);
        }

        /* Trending Stocks */
        .trending-section {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .stocks-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stock-item {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid transparent;
            border-radius: 10px;
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .stock-item:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .stock-info h4 {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stock-info p {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .stock-price {
            font-family: 'Roboto Mono', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Gainers & Losers */
        .gainers-losers-section {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .performance-box {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
        }

        .performance-title {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .gainers-list, .losers-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .gainer-item, .loser-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .gainer-item:hover, .loser-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .stock-symbol {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 15px;
            font-family: 'Roboto Mono', monospace;
        }

        .stock-change {
            font-family: 'Roboto Mono', monospace;
            font-weight: 700;
            font-size: 14px;
        }

        /* Right Panel */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* FII/DII Activity */
        .institutional-activity {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
        }

        .activity-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .activity-item {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 18px;
            text-align: center;
            transition: all 0.3s;
        }

        .activity-item:hover {
            background: rgba(30, 41, 59, 0.8);
            transform: translateY(-2px);
        }

        .activity-label {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .activity-value {
            font-size: 22px;
            font-weight: 800;
            font-family: 'Roboto Mono', monospace;
        }

        /* Market News */
        .market-news {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            max-height: 450px;
            overflow-y: auto;
        }

        .news-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .news-item {
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
            cursor: pointer;
        }

        .news-item:hover {
            background: rgba(30, 41, 59, 0.8);
            transform: translateX(5px);
        }

        .news-time {
            color: var(--primary);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Roboto Mono', monospace;
        }

        .news-headline {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .news-source {
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
        }

        /* Market Indicators */
        .market-indicators {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .indicator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
        }

        .indicator-label {
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
        }

        .indicator-value {
            color: var(--text-primary);
            font-family: 'Roboto Mono', monospace;
            font-weight: 600;
            font-size: 14px;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px 0;
            color: var(--text-secondary);
            font-size: 14px;
            border-top: 1px solid var(--border);
            margin-top: 40px;
        }

        /* Price Flashing Animations */
        @keyframes flashGreen {
            0% { background-color: transparent; }
            50% { background-color: rgba(16, 185, 129, 0.3); }
            100% { background-color: transparent; }
        }

        @keyframes flashRed {
            0% { background-color: transparent; }
            50% { background-color: rgba(239, 68, 68, 0.3); }
            100% { background-color: transparent; }
        }

        .flash-green {
            animation: flashGreen 0.8s ease-out;
        }

        .flash-red {
            animation: flashRed 0.8s ease-out;
        }

        /* Time Display */
        #liveTime {
            font-family: 'Roboto Mono', monospace;
            font-size: 15px;
            color: var(--primary);
            font-weight: 600;
            letter-spacing: 1px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(100, 116, 139, 0.5);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.7);
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }

            .stocks-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .market-stats {
                grid-template-columns: 1fr;
            }

            .stocks-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .performance-grid {
                grid-template-columns: 1fr;
            }

            .activity-grid {
                grid-template-columns: 1fr;
            }

            .indicators-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .live-status {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <h1><i class="fas fa-chart-line"></i> VISION TRADE</h1>
            <p>Live market insights • AI-powered stock analysis • Investment recommendations</p>
        </div>
        <div class="live-status">
            <div class="status-item">
                <div class="live-indicator"></div>
                <span>LIVE MARKET</span>
            </div>
            <div class="status-item">
                <i class="fas fa-clock"></i>
                <span id="liveTime">15:30:45.782</span>
            </div>
            <a href="main-dashboard.html" class="nav-button">
                <i class="fas fa-arrow-right"></i> Go to Dashboard
            </a>
        </div>
    </header>

    <!-- Market Stats -->
    <div class="market-stats">
        <div class="stat-card">
            <div class="stat-label">NIFTY 50</div>
            <div class="stat-value" id="niftyValue">22,212.70</div>
            <div class="stat-change positive" id="niftyChange">+84.35 (+0.38%)</div>
            <div class="volume-bar">
                <div class="volume-fill" style="width: 75%"></div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-label">SENSEX</div>
            <div class="stat-value" id="sensexValue">73,142.80</div>
            <div class="stat-change positive" id="sensexChange">+276.50 (+0.38%)</div>
            <div class="volume-bar">
                <div class="volume-fill" style="width: 68%"></div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-label">NIFTY 500</div>
            <div class="stat-value" id="nifty500Value">18,635.25</div>
            <div class="stat-change positive" id="nifty500Change">+182.75 (+0.99%)</div>
            <div class="volume-bar">
                <div class="volume-fill" style="width: 82%"></div>
            </div>
        </div>
    </div>

    <!-- Main Grid -->
    <div class="main-grid">
        <!-- Left Column -->
        <div>
            <!-- Charts Section -->
            <div class="charts-section">
                <div class="section-title">
                    <i class="fas fa-chart-area"></i> Market Indices Today
                </div>
                <div class="charts-container">
                    <div class="chart-box">
                        <canvas id="niftyChart"></canvas>
                    </div>
                    <div class="chart-box">
                        <canvas id="sensexChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Trending Stocks -->
            <div class="trending-section">
                <div class="section-title">
                    <i class="fas fa-fire"></i> Trending Stocks
                </div>
                <div class="stocks-grid" id="trendingStocks">
                    <!-- Stocks will be loaded dynamically -->
                </div>
            </div>

            <!-- Gainers & Losers -->
            <div class="gainers-losers-section">
                <div class="section-title">
                    <i class="fas fa-trophy"></i> Top Performers Today
                </div>
                <div class="performance-grid">
                    <div class="performance-box">
                        <div class="performance-title positive">
                            <i class="fas fa-arrow-up"></i> Top Gainers
                        </div>
                        <div class="gainers-list" id="gainersList">
                            <!-- Gainers will be loaded dynamically -->
                        </div>
                    </div>
                    <div class="performance-box">
                        <div class="performance-title negative">
                            <i class="fas fa-arrow-down"></i> Top Losers
                        </div>
                        <div class="losers-list" id="losersList">
                            <!-- Losers will be loaded dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="right-panel">
            <!-- FII/DII Activity -->
            <div class="institutional-activity">
                <div class="section-title">
                    <i class="fas fa-university"></i> Institutional Activity
                </div>
                <div class="activity-grid">
                    <div class="activity-item">
                        <div class="activity-label">FII BUY (₹ Cr)</div>
                        <div class="activity-value positive" id="fiiBuy">2,345.67</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-label">FII SELL (₹ Cr)</div>
                        <div class="activity-value negative" id="fiiSell">1,987.32</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-label">DII BUY (₹ Cr)</div>
                        <div class="activity-value positive" id="diiBuy">1,234.56</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-label">DII SELL (₹ Cr)</div>
                        <div class="activity-value negative" id="diiSell">876.54</div>
                    </div>
                </div>
            </div>

            <!-- Market News -->
            <div class="market-news">
                <div class="section-title">
                    <i class="fas fa-newspaper"></i> Market News
                </div>
                <div class="news-list" id="newsList">
                    <!-- News will be loaded dynamically from API -->
                    <div class="news-item">
                        <div class="news-time">
                            <i class="fas fa-clock"></i>
                            Loading real news...
                        </div>
                        <div class="news-headline">Fetching latest market updates from reliable sources</div>
                        <div class="news-source">Smart Investment Advisor</div>
                    </div>
                </div>
            </div>

            <!-- Market Indicators -->
            <div class="market-indicators">
                <div class="section-title">
                    <i class="fas fa-chart-bar"></i> Market Indicators
                </div>
                <div class="indicators-grid">
                    <div class="indicator-item">
                        <span class="indicator-label">Advances</span>
                        <span class="indicator-value positive" id="advances">1,542</span>
                    </div>
                    <div class="indicator-item">
                        <span class="indicator-label">Declines</span>
                        <span class="indicator-value negative" id="declines">845</span>
                    </div>
                    <div class="indicator-item">
                        <span class="indicator-label">Unchanged</span>
                        <span class="indicator-value" id="unchanged">130</span>
                    </div>
                    <div class="indicator-item">
                        <span class="indicator-label">Market Breadth</span>
                        <span class="indicator-value positive" id="marketBreadth">1.82</span>
                    </div>
                    <div class="indicator-item">
                        <span class="indicator-label">Volume (₹ Cr)</span>
                        <span class="indicator-value" id="volume">45,678</span>
                    </div>
                    <div class="indicator-item">
                        <span class="indicator-label">Turnover (₹ Cr)</span>
                        <span class="indicator-value" id="turnover">1,23,456</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>© 2024 Smart Investment Advisor. Live market data updated in real-time.</p>
        <p>AI-powered insights for smarter investment decisions. Data Source: NSE/BSE Feed & Financial APIs</p>
    </footer>
</div>

<script>
    // ============================================
    // REAL-TIME MARKET SIMULATION ENGINE
    // ============================================

    // API Configuration
    const NEWS_API_KEY = 'cc8f0a90ac9a4e6fb17024ef764d1c10'; // NewsAPI key (free tier)
    const ALPHA_VANTAGE_API_KEY = 'demo'; // Alpha Vantage API key
    const FINNHUB_API_KEY = 'ck8lplpr01qi6u4lb2t0ck8lplpr01qi6u4lb2tg'; // Finnhub API key

    // Configuration
    const MARKET_CONFIG = {
        updateInterval: 3000, // Update every 3 seconds
        priceVolatility: 0.02,
        maxGainers: 5,
        maxLosers: 5,
        trendingStocksCount: 6
    };

    // Real Indian stocks data
    const INDIAN_STOCKS = [
        { symbol: 'RELIANCE', name: 'Reliance Industries', price: 2835.45, changePercent: 1.25 },
        { symbol: 'TCS', name: 'Tata Consultancy', price: 3750.80, changePercent: -0.45 },
        { symbol: 'HDFCBANK', name: 'HDFC Bank', price: 1650.30, changePercent: 0.85 },
        { symbol: 'INFY', name: 'Infosys', price: 1520.75, changePercent: 0.35 },
        { symbol: 'ICICIBANK', name: 'ICICI Bank', price: 1050.60, changePercent: 1.15 },
        { symbol: 'HINDUNILVR', name: 'Hindustan Unilever', price: 2450.90, changePercent: -0.25 },
        { symbol: 'ITC', name: 'ITC Ltd', price: 425.45, changePercent: 0.95 },
        { symbol: 'SBIN', name: 'State Bank of India', price: 750.30, changePercent: 1.45 },
        { symbol: 'BHARTIARTL', name: 'Bharti Airtel', price: 1215.45, changePercent: 0.65 },
        { symbol: 'KOTAKBANK', name: 'Kotak Mahindra', price: 1765.90, changePercent: 0.55 },
        { symbol: 'WIPRO', name: 'Wipro Ltd', price: 485.30, changePercent: -0.75 },
        { symbol: 'AXISBANK', name: 'Axis Bank', price: 1085.60, changePercent: 0.95 }
    ];

    // Market indices data
    let marketData = {
        nifty: { value: 22212.70, change: 84.35, changePercent: 0.38 },
        sensex: { value: 73142.80, change: 276.50, changePercent: 0.38 },
        nifty500: { value: 18635.25, change: 182.75, changePercent: 0.99 },
        lastUpdate: null,
        updateCount: 0
    };

    // Chart instances
    let charts = {};

    // ============================================
    // REAL NEWS API INTEGRATION
    // ============================================

    async function fetchRealNews() {
        try {
            // 1. Indian Express Business RSS (Free, no API key)
            const response = await fetch(
                'https://api.rss2json.com/v1/api.json?rss_url=https://indianexpress.com/section/business/feed/'
            );

            if (response.ok) {
                const data = await response.json();
                if (data.items && data.items.length > 0) {
                    return data.items.map(item => ({
                        time: new Date(item.pubDate).toLocaleTimeString('en-IN', { hour12: false }),
                        headline: item.title,
                        source: 'Indian Express',
                        url: item.link,
                        description: item.description
                    })).slice(0, 10);
                }
            }
        } catch (error) {
            console.warn('Indian Express RSS failed:', error);
        }

        try {
            // 2. Business Standard RSS
            const response = await fetch(
                'https://api.rss2json.com/v1/api.json?rss_url=http://www.business-standard.com/rss/home_page_top_stories.rss'
            );

            if (response.ok) {
                const data = await response.json();
                if (data.items && data.items.length > 0) {
                    return data.items.map(item => ({
                        time: new Date(item.pubDate).toLocaleTimeString('en-IN', { hour12: false }),
                        headline: item.title,
                        source: 'Business Standard',
                        url: item.link,
                        description: item.description
                    })).slice(0, 10);
                }
            }
        } catch (error) {
            console.warn('Business Standard RSS failed:', error);
        }

        try {
            // 3. Financial Express RSS
            const response = await fetch(
                'https://api.rss2json.com/v1/api.json?rss_url=https://www.financialexpress.com/feed/'
            );

            if (response.ok) {
                const data = await response.json();
                if (data.items && data.items.length > 0) {
                    return data.items.map(item => ({
                        time: new Date(item.pubDate).toLocaleTimeString('en-IN', { hour12: false }),
                        headline: item.title,
                        source: 'Financial Express',
                        url: item.link,
                        description: item.description
                    })).slice(0, 10);
                }
            }
        } catch (error) {
            console.warn('Financial Express RSS failed:', error);
        }

        // If all fails, return simulated news
        return getSimulatedNews();
    }

    function getSimulatedNews() {
        const headlines = [
            'FIIs turn net buyers in Indian equities, invest ₹2,345 crore',
            'RBI likely to maintain status quo in February policy meeting',
            'Reliance announces major expansion in renewable energy sector',
            'IT stocks under pressure ahead of US Fed meeting minutes',
            'Bank Nifty hits fresh record high, up 0.39% for the day',
            'Auto sales show strong growth in January, Maruti leads',
            'Pharma sector gains as USFDA approvals boost sentiment',
            'Gold prices edge lower as dollar strengthens against rupee',
            'Market breadth positive with 3:2 advance-decline ratio',
            'Rupee trades range-bound against US dollar'
        ];

        const sources = ['Reuters', 'Bloomberg', 'ET Markets', 'Moneycontrol', 'CNBC TV18'];

        return headlines.map((headline, index) => ({
            time: new Date(Date.now() - index * 600000).toLocaleTimeString('en-IN', { hour12: false }),
            headline: headline,
            source: sources[index % sources.length],
            url: '#'
        }));
    }

    async function loadMarketNews() {
        const newsContainer = document.getElementById('newsList');

        try {
            const news = await fetchRealNews();
            newsContainer.innerHTML = '';

            news.forEach(item => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';
                newsItem.onclick = () => window.open(item.url, '_blank');
                newsItem.innerHTML = `
                        <div class="news-time">
                            <i class="fas fa-clock"></i>
                            ${item.time}
                        </div>
                        <div class="news-headline">${item.headline}</div>
                        <div class="news-source">${item.source}</div>
                    `;
                newsContainer.appendChild(newsItem);
            });
        } catch (error) {
            console.error('Failed to load news:', error);
            // Load simulated news on error
            const simulatedNews = getSimulatedNews();
            newsContainer.innerHTML = '';
            simulatedNews.forEach(item => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';
                newsItem.innerHTML = `
                        <div class="news-time">
                            <i class="fas fa-clock"></i>
                            ${item.time}
                        </div>
                        <div class="news-headline">${item.headline}</div>
                        <div class="news-source">${item.source}</div>
                    `;
                newsContainer.appendChild(newsItem);
            });
        }
    }

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================

    function formatIndianNumber(num) {
        return num.toLocaleString('en-IN', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    function generatePriceMovement(basePrice, volatility = 0.02) {
        const changePercent = (Math.random() - 0.5) * volatility * 2;
        const newPrice = basePrice * (1 + changePercent / 100);
        return {
            price: Math.round(newPrice * 100) / 100,
            changePercent: changePercent,
            change: newPrice - basePrice
        };
    }

    function updateLiveTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-IN', {
            hour12: false,
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        }) + '.' + now.getMilliseconds().toString().padStart(3, '0');

        document.getElementById('liveTime').textContent = timeString;
        marketData.lastUpdate = now;
    }

    // ============================================
    // CHART INITIALIZATION
    // ============================================

    function initializeCharts() {
        const niftyCtx = document.getElementById('niftyChart').getContext('2d');
        const sensexCtx = document.getElementById('sensexChart').getContext('2d');

        // Generate time labels for the day
        const timeLabels = [];
        for (let i = 9; i <= 15; i++) {
            timeLabels.push(`${i}:00`);
        }

        // NIFTY Chart
        charts.nifty = new Chart(niftyCtx, {
            type: 'line',
            data: {
                labels: timeLabels,
                datasets: [{
                    label: 'NIFTY 50',
                    data: generateChartData(22212, 22300, timeLabels.length),
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 5
                }]
            },
            options: getChartOptions('NIFTY 50')
        });

        // SENSEX Chart
        charts.sensex = new Chart(sensexCtx, {
            type: 'line',
            data: {
                labels: timeLabels,
                datasets: [{
                    label: 'SENSEX',
                    data: generateChartData(73142, 73500, timeLabels.length),
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 5
                }]
            },
            options: getChartOptions('SENSEX')
        });
    }

    // Replace the entire chart initialization and update functions:

    // REAL Chart Data Configuration
    const CHART_CONFIG = {
        updateInterval: 60000, // Update every 60 seconds
        timeFrame: '1d', // 1 day
        interval: '5m' // 5 minute intervals
    };

    // Real stock symbols
    const REAL_INDICES = {
        nifty: '^NSEI',
        sensex: '^BSESN',
        nifty500: '^CRSLDX'
    };

    async function fetchRealChartData(symbol, period = '1d', interval = '5m') {
        try {
            // Method 1: Yahoo Finance via RapidAPI (More reliable)
            const response = await fetch(
                `https://yahoo-finance127.p.rapidapi.com/historic/${symbol}/${period}/${interval}`,
                {
                    headers: {
                        'X-RapidAPI-Key': 'a47f9b2a40msh3b5f10e406a56eep139de0jsnba23397a7f2d',
                        'X-RapidAPI-Host': 'yahoo-finance127.p.rapidapi.com'
                    }
                }
            );

            if (response.ok) {
                const data = await response.json();
                if (data.timestamp && data.indicators) {
                    const quotes = data.indicators.quote[0];
                    const timestamps = data.timestamp;

                    // Process the data
                    const chartData = [];
                    const labels = [];

                    for (let i = 0; i < timestamps.length; i++) {
                        if (quotes.close[i]) {
                            chartData.push(quotes.close[i]);
                            const date = new Date(timestamps[i] * 1000);
                            labels.push(date.toLocaleTimeString('en-IN', {
                                hour12: false,
                                hour: '2-digit',
                                minute: '2-digit'
                            }));
                        }
                    }

                    return { data: chartData, labels: labels };
                }
            }
        } catch (error) {
            console.warn(`RapidAPI failed for ${symbol}:`, error);
        }

        try {
            // Method 2: Direct Yahoo Finance API (Alternative)
            const response = await fetch(
                `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=${interval}&range=${period}`
            );

            if (response.ok) {
                const data = await response.json();
                const result = data.chart.result[0];
                const quotes = result.indicators.quote[0];
                const timestamps = result.timestamp;

                const chartData = [];
                const labels = [];

                for (let i = 0; i < timestamps.length; i++) {
                    if (quotes.close[i]) {
                        chartData.push(quotes.close[i]);
                        const date = new Date(timestamps[i] * 1000);
                        labels.push(date.toLocaleTimeString('en-IN', {
                            hour12: false,
                            hour: '2-digit',
                            minute: '2-digit'
                        }));
                    }
                }

                return { data: chartData, labels: labels };
            }
        } catch (error) {
            console.warn(`Yahoo API failed for ${symbol}:`, error);
        }

        // Fallback to simulated data
        return generateSimulatedChartData(symbol);
    }

    function generateSimulatedChartData(symbol) {
        // Base values for simulation
        const baseValues = {
            '^NSEI': { min: 22000, max: 22500 },
            '^BSESN': { min: 73000, max: 74000 },
            '^CRSLDX': { min: 18500, max: 19000 }
        };

        const base = baseValues[symbol] || { min: 10000, max: 11000 };
        const timeLabels = [];
        const data = [];

        // Generate data for trading hours (9:15 to 15:30)
        let current = base.min + Math.random() * (base.max - base.min) * 0.1;

        for (let hour = 9; hour <= 15; hour++) {
            for (let minute = 15; minute <= 55; minute += 5) {
                if (hour === 15 && minute > 30) break;

                timeLabels.push(`${hour}:${minute.toString().padStart(2, '0')}`);
                data.push(current);

                // Realistic price movement
                const change = (Math.random() - 0.5) * (base.max - base.min) * 0.001;
                current += change;
                current = Math.max(base.min * 0.99, Math.min(base.max * 1.01, current));
            }
        }

        return { data: data, labels: timeLabels };
    }

    async function initializeRealCharts() {
        try {
            // Fetch real data for both charts
            const niftyData = await fetchRealChartData(REAL_INDICES.nifty, CHART_CONFIG.timeFrame, CHART_CONFIG.interval);
            const sensexData = await fetchRealChartData(REAL_INDICES.sensex, CHART_CONFIG.timeFrame, CHART_CONFIG.interval);

            // Initialize NIFTY Chart
            const niftyCtx = document.getElementById('niftyChart').getContext('2d');
            charts.nifty = new Chart(niftyCtx, {
                type: 'line',
                data: {
                    labels: niftyData.labels,
                    datasets: [{
                        label: 'NIFTY 50',
                        data: niftyData.data,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: getRealChartOptions('NIFTY 50')
            });

            // Initialize SENSEX Chart
            const sensexCtx = document.getElementById('sensexChart').getContext('2d');
            charts.sensex = new Chart(sensexCtx, {
                type: 'line',
                data: {
                    labels: sensexData.labels,
                    datasets: [{
                        label: 'SENSEX',
                        data: sensexData.data,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: getRealChartOptions('SENSEX')
            });

            console.log('✅ Real charts initialized with live data');
        } catch (error) {
            console.error('Failed to initialize real charts:', error);
            // Fallback to simulated charts
            initializeSimulatedCharts();
        }
    }

    function getRealChartOptions(title) {
        return {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(15, 23, 42, 0.95)',
                    titleColor: '#f1f5f9',
                    bodyColor: '#cbd5e1',
                    borderColor: '#1e293b',
                    borderWidth: 1,
                    callbacks: {
                        label: function(context) {
                            return `${title}: ₹${context.parsed.y.toLocaleString('en-IN', {minimumFractionDigits: 2})}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#94a3b8',
                        maxTicksLimit: 8
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#94a3b8',
                        callback: function(value) {
                            return '₹' + value.toLocaleString('en-IN');
                        }
                    }
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        };
    }

    async function updateRealCharts() {
        if (!charts.nifty || !charts.sensex) return;

        try {
            // Fetch latest data
            const niftyData = await fetchRealChartData(REAL_INDICES.nifty, '1d', '5m');
            const sensexData = await fetchRealChartData(REAL_INDICES.sensex, '1d', '5m');

            // Update NIFTY chart
            if (niftyData.data.length > 0) {
                charts.nifty.data.labels = niftyData.labels;
                charts.nifty.data.datasets[0].data = niftyData.data;
                charts.nifty.update('none');
            }

            // Update SENSEX chart
            if (sensexData.data.length > 0) {
                charts.sensex.data.labels = sensexData.labels;
                charts.sensex.data.datasets[0].data = sensexData.data;
                charts.sensex.update('none');
            }

            // Update market stats with real data
            updateRealMarketStats(niftyData.data, sensexData.data);

        } catch (error) {
            console.warn('Failed to update real charts:', error);
            // Fallback to simulated updates
            updateSimulatedCharts();
        }
    }

    function updateRealMarketStats(niftyData, sensexData) {
        if (niftyData && niftyData.length > 0) {
            const currentNifty = niftyData[niftyData.length - 1];
            const previousNifty = niftyData[0];
            const niftyChange = currentNifty - previousNifty;
            const niftyChangePercent = (niftyChange / previousNifty) * 100;

            document.getElementById('niftyValue').textContent = currentNifty.toLocaleString('en-IN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            document.getElementById('niftyChange').textContent =
                `${niftyChange >= 0 ? '+' : ''}${niftyChange.toFixed(2)} (${niftyChange >= 0 ? '+' : ''}${niftyChangePercent.toFixed(2)}%)`;
            document.getElementById('niftyChange').className = `stat-change ${niftyChange >= 0 ? 'positive' : 'negative'}`;
        }

        if (sensexData && sensexData.length > 0) {
            const currentSensex = sensexData[sensexData.length - 1];
            const previousSensex = sensexData[0];
            const sensexChange = currentSensex - previousSensex;
            const sensexChangePercent = (sensexChange / previousSensex) * 100;

            document.getElementById('sensexValue').textContent = currentSensex.toLocaleString('en-IN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            document.getElementById('sensexChange').textContent =
                `${sensexChange >= 0 ? '+' : ''}${sensexChange.toFixed(2)} (${sensexChange >= 0 ? '+' : ''}${sensexChangePercent.toFixed(2)}%)`;
            document.getElementById('sensexChange').className = `stat-change ${sensexChange >= 0 ? 'positive' : 'negative'}`;
        }
    }


    // ============================================
    // MARKET INDICES UPDATES
    // ============================================

    function updateMarketIndices() {
        // Update NIFTY 50
        const niftyMovement = generatePriceMovement(marketData.nifty.value, 0.01);
        marketData.nifty.value = niftyMovement.price;
        marketData.nifty.change += niftyMovement.change;
        marketData.nifty.changePercent = (marketData.nifty.change / (marketData.nifty.value - marketData.nifty.change)) * 100;

        updateStatDisplay('niftyValue', marketData.nifty.value);
        updateStatChange('niftyChange', marketData.nifty.change, marketData.nifty.changePercent);

        // Update SENSEX
        const sensexMovement = generatePriceMovement(marketData.sensex.value, 0.01);
        marketData.sensex.value = sensexMovement.price;
        marketData.sensex.change += sensexMovement.change;
        marketData.sensex.changePercent = (marketData.sensex.change / (marketData.sensex.value - marketData.sensex.change)) * 100;

        updateStatDisplay('sensexValue', marketData.sensex.value);
        updateStatChange('sensexChange', marketData.sensex.change, marketData.sensex.changePercent);

        // Update NIFTY 500
        const nifty500Movement = generatePriceMovement(marketData.nifty500.value, 0.015);
        marketData.nifty500.value = nifty500Movement.price;
        marketData.nifty500.change += nifty500Movement.change;
        marketData.nifty500.changePercent = (marketData.nifty500.change / (marketData.nifty500.value - marketData.nifty500.change)) * 100;

        updateStatDisplay('nifty500Value', marketData.nifty500.value);
        updateStatChange('nifty500Change', marketData.nifty500.change, marketData.nifty500.changePercent);
    }

    function updateStatDisplay(elementId, newValue) {
        const element = document.getElementById(elementId);
        if (!element) return;

        const oldValue = parseFloat(element.textContent.replace(/,/g, ''));

        // Add flashing effect
        if (newValue > oldValue) {
            element.classList.add('flash-green');
            setTimeout(() => element.classList.remove('flash-green'), 800);
        } else if (newValue < oldValue) {
            element.classList.add('flash-red');
            setTimeout(() => element.classList.remove('flash-red'), 800);
        }

        element.textContent = formatIndianNumber(newValue);
    }

    function updateStatChange(elementId, change, changePercent) {
        const element = document.getElementById(elementId);
        if (!element) return;

        const isPositive = change >= 0;
        element.textContent = `${isPositive ? '+' : ''}${change.toFixed(2)} (${isPositive ? '+' : ''}${changePercent.toFixed(2)}%)`;
        element.className = `stat-change ${isPositive ? 'positive' : 'negative'}`;
    }

    // ============================================
    // TRENDING STOCKS UPDATES
    // ============================================

    function updateTrendingStocks() {
        const container = document.getElementById('trendingStocks');
        if (!container) return;

        // Update prices
        INDIAN_STOCKS.forEach(stock => {
            const movement = generatePriceMovement(stock.price, 0.05);
            stock.price = movement.price;
            stock.changePercent += movement.changePercent;
        });

        // Sort by absolute change (most trending)
        const trending = [...INDIAN_STOCKS]
            .sort((a, b) => Math.abs(b.changePercent) - Math.abs(a.changePercent))
            .slice(0, MARKET_CONFIG.trendingStocksCount);

        // Update display
        container.innerHTML = '';
        trending.forEach(stock => {
            const stockElement = document.createElement('div');
            stockElement.className = 'stock-item';
            stockElement.innerHTML = `
                    <div class="stock-info">
                        <h4>${stock.symbol}</h4>
                        <p>${stock.name}</p>
                    </div>
                    <div class="stock-price">
                        ₹${formatIndianNumber(stock.price)}
                        <div class="stat-change ${stock.changePercent >= 0 ? 'positive' : 'negative'}">
                            ${stock.changePercent >= 0 ? '+' : ''}${stock.changePercent.toFixed(2)}%
                        </div>
                    </div>
                `;
            container.appendChild(stockElement);
        });

        updateGainersLosers();
    }

    function updateGainersLosers() {
        // Sort stocks by performance
        const sortedStocks = [...INDIAN_STOCKS].sort((a, b) => b.changePercent - a.changePercent);

        // Get top gainers and losers
        const gainers = sortedStocks.slice(0, MARKET_CONFIG.maxGainers);
        const losers = sortedStocks.slice(-MARKET_CONFIG.maxLosers).reverse();

        // Update gainers list
        const gainersList = document.getElementById('gainersList');
        if (gainersList) {
            gainersList.innerHTML = '';
            gainers.forEach(stock => {
                const item = document.createElement('div');
                item.className = 'gainer-item';
                item.innerHTML = `
                        <span class="stock-symbol">${stock.symbol}</span>
                        <span class="stock-change positive">+${stock.changePercent.toFixed(2)}%</span>
                    `;
                gainersList.appendChild(item);
            });
        }

        // Update losers list
        const losersList = document.getElementById('losersList');
        if (losersList) {
            losersList.innerHTML = '';
            losers.forEach(stock => {
                const item = document.createElement('div');
                item.className = 'loser-item';
                item.innerHTML = `
                        <span class="stock-symbol">${stock.symbol}</span>
                        <span class="stock-change negative">${stock.changePercent.toFixed(2)}%</span>
                    `;
                losersList.appendChild(item);
            });
        }
    }

    // ============================================
    // INSTITUTIONAL ACTIVITY UPDATES
    // ============================================

    function updateInstitutionalActivity() {
        const updates = {
            'fiiBuy': { current: 2345.67, maxChange: 50 },
            'fiiSell': { current: 1987.32, maxChange: 50 },
            'diiBuy': { current: 1234.56, maxChange: 30 },
            'diiSell': { current: 876.54, maxChange: 30 }
        };

        Object.entries(updates).forEach(([id, data]) => {
            const element = document.getElementById(id);
            if (element) {
                const change = (Math.random() - 0.5) * data.maxChange;
                const newValue = Math.max(0, data.current + change);

                // Update display with animation
                if (newValue > parseFloat(element.textContent.replace(/,/g, ''))) {
                    element.classList.add('flash-green');
                    setTimeout(() => element.classList.remove('flash-green'), 800);
                } else if (newValue < parseFloat(element.textContent.replace(/,/g, ''))) {
                    element.classList.add('flash-red');
                    setTimeout(() => element.classList.remove('flash-red'), 800);
                }

                element.textContent = formatIndianNumber(newValue);
                updates[id].current = newValue;
            }
        });
    }

    // ============================================
    // MARKET INDICATORS UPDATES
    // ============================================

    function updateMarketIndicators() {
        const indicators = {
            'advances': { current: 1542, min: 1400, max: 1700 },
            'declines': { current: 845, min: 700, max: 950 },
            'unchanged': { current: 130, min: 100, max: 160 },
            'marketBreadth': { current: 1.82, min: 1.5, max: 2.2 },
            'volume': { current: 45678, min: 40000, max: 50000 },
            'turnover': { current: 123456, min: 110000, max: 130000 }
        };

        Object.entries(indicators).forEach(([id, data]) => {
            const element = document.getElementById(id);
            if (element) {
                const change = (Math.random() - 0.5) * (data.max - data.min) * 0.1;
                const newValue = Math.max(data.min, Math.min(data.max, data.current + change));

                element.textContent = formatIndianNumber(newValue);
                indicators[id].current = newValue;
            }
        });
    }

    // ============================================
    // CHARTS UPDATES
    // ============================================

    function updateCharts() {
        if (!charts.nifty || !charts.sensex) return;

        // Update NIFTY chart
        const niftyData = charts.nifty.data.datasets[0].data;
        const lastNiftyValue = niftyData[niftyData.length - 1];
        const newNiftyValue = lastNiftyValue + (Math.random() - 0.5) * 50;
        niftyData.push(newNiftyValue);
        niftyData.shift();

        charts.nifty.update('none');

        // Update SENSEX chart
        const sensexData = charts.sensex.data.datasets[0].data;
        const lastSensexValue = sensexData[sensexData.length - 1];
        const newSensexValue = lastSensexValue + (Math.random() - 0.5) * 100;
        sensexData.push(newSensexValue);
        sensexData.shift();

        charts.sensex.update('none');
    }

    // ============================================
    // MAIN UPDATE FUNCTION
    // ============================================

    function updateMarketData() {
        marketData.updateCount++;

        // Update market indices
        updateMarketIndices();

        // Update trending stocks
        updateTrendingStocks();

        // Update institutional activity
        updateInstitutionalActivity();

        // Update market indicators
        updateMarketIndicators();

        // Update charts
        updateCharts();

        // Update time
        updateLiveTime();
    }

    // ============================================
    // INITIALIZATION
    // ============================================

    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Initializing with Real charts...');

        // Initialize charts
        initializeRealCharts();

        // Load real market news
        loadMarketNews();

        // Initialize time
        updateLiveTime();

        // Initialize trending stocks
        updateTrendingStocks();

        // Start market updates
        setInterval(updateRealCharts, CHART_CONFIG.updateInterval);
        setInterval(updateMarketData, MARKET_CONFIG.updateInterval);
        setInterval(updateLiveTime, 100);

        // Update time every 100ms
        setInterval(updateLiveTime, 100);

        // Update news every 5 minutes
        setInterval(loadMarketNews, 5 * 60 * 1000);

        console.log('✅ Home page initialized with REAL charts');

        // ============================================
        // INSTANT STOCK PROCESSING - PRELOADED DATA
        // ============================================

        // Check if we have preprocessed data
        function initInstantStockProcessing() {
            const showBtn = document.getElementById('showStockAnalyzerBtn');
            const startBtn = document.getElementById('startProcessingBtn');

            if (!showBtn) return;

            // Check for cached data immediately
            checkForCachedData();

            // Toggle visibility
            showBtn.addEventListener('click', function() {
                const section = document.getElementById('stockProcessingSection');
                if (section.style.display === 'none' || section.style.display === '') {
                    section.style.display = 'block';

                    // INSTANTLY show cached data if available
                    const cachedData = localStorage.getItem('stock_sectors_data');
                    if (cachedData) {
                        displayCachedResults(JSON.parse(cachedData));
                    } else {
                        // Show option to load
                        document.getElementById('sectorResults').innerHTML = `
                            <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                <i class="fas fa-database" style="font-size: 32px; margin-bottom: 15px; color: var(--primary);"></i>
                                <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">No Preprocessed Data Found</div>
                                <div style="font-size: 14px; margin-bottom: 20px;">Process stocks to see instant results</div>
                                <button onclick="startInstantProcessing()" class="small-btn" style="margin: 5px;">
                                    <i class="fas fa-bolt"></i> Process 3500+ Stocks
                                </button>
                            </div>
                        `;
                    }
                } else {
                    section.style.display = 'none';
                }
            });

            // Override start button
            if (startBtn) {
                startBtn.addEventListener('click', startInstantProcessing);
            }

            console.log('✅ Instant stock processing ready');
        }

        // Check for cached data on page load
        function checkForCachedData() {
            const cachedData = localStorage.getItem('stock_sectors_data');
            if (cachedData) {
                const data = JSON.parse(cachedData);
                const timestamp = localStorage.getItem('stock_sectors_timestamp');
                const age = Date.now() - timestamp;

                if (age < 24 * 60 * 60 * 1000) { // Less than 24 hours old
                    document.getElementById('totalStocks').textContent = data.total_stocks.toLocaleString();
                    console.log(`✅ Using cached data: ${data.total_stocks} stocks`);
                }
            }
        }

        // INSTANT Processing - Shows immediate results
        function startInstantProcessing() {
            // Load preprocessed JSON file INSTANTLY
            loadPreprocessedData();
        }

        // Load preprocessed JSON file
        async function loadPreprocessedData() {
            document.getElementById('statusText').textContent = 'Loading preprocessed data...';
            document.getElementById('statusText').style.color = 'var(--primary)';

            try {
                // Try to load from preprocessed file
                const response = await fetch('stock_sectors_preprocessed.json');

                if (response.ok) {
                    const data = await response.json();

                    // Cache it
                    localStorage.setItem('stock_sectors_data', JSON.stringify(data));
                    localStorage.setItem('stock_sectors_timestamp', Date.now());

                    // INSTANTLY display results
                    displayCachedResults(data);
                    showNotification(`✅ Loaded ${data.total_stocks.toLocaleString()} preprocessed stocks instantly`, 'success');

                } else {
                    // Fallback: Process in background with Web Worker
                    processWithWorker();
                }

            } catch (error) {
                console.log('No preprocessed file, using worker...');
                processWithWorker();
            }
        }

        // Process with Web Worker (only if no preprocessed data)
        function processWithWorker() {
            document.getElementById('startProcessingBtn').style.display = 'none';
            document.getElementById('pauseProcessingBtn').style.display = 'inline-flex';
            document.getElementById('statusText').textContent = 'Processing with Web Worker...';

            const worker = new Worker('stock-worker-fast.js');

            worker.onmessage = function(e) {
                const { type, data } = e.data;

                if (type === 'progress') {
                    document.getElementById('progressBar').style.width = data.percent + '%';
                    document.getElementById('progressPercentage').textContent = data.percent + '%';
                    document.getElementById('processedCount').textContent = data.processed.toLocaleString();
                }
                else if (type === 'complete') {
                    displayResults(data.results);
                    showNotification(`✅ Processed ${data.total} stocks in ${(data.time/1000).toFixed(1)}s`, 'success');

                    // Cache results
                    const cacheData = {
                        processed_at: new Date().toISOString(),
                        total_stocks: data.total,
                        stocks: data.results
                    };
                    localStorage.setItem('stock_sectors_data', JSON.stringify(cacheData));
                    localStorage.setItem('stock_sectors_timestamp', Date.now());

                    worker.terminate();
                }
            };

            // Start processing
            worker.postMessage({ action: 'process' });
        }

        // INSTANTLY display cached results
        function displayCachedResults(data) {
            document.getElementById('startProcessingBtn').style.display = 'none';
            document.getElementById('exportResultsBtn').style.display = 'inline-flex';
            document.getElementById('statusText').textContent = 'Using preprocessed data ✓';
            document.getElementById('statusText').style.color = 'var(--success)';
            document.getElementById('totalStocks').textContent = data.total_stocks.toLocaleString();
            document.getElementById('processedCount').textContent = data.total_stocks.toLocaleString();
            document.getElementById('progressBar').style.width = '100%';
            document.getElementById('progressPercentage').textContent = '100%';

            // Display sector distribution
            displayResults(data.stocks);
        }

        // Display results
        function displayResults(results) {
            // Group by sector
            const sectors = {};
            results.forEach(stock => {
                sectors[stock.sector] = (sectors[stock.sector] || 0) + 1;
            });

            // Sort by count
            const sorted = Object.entries(sectors)
                .map(([sector, count]) => ({ sector, count }))
                .sort((a, b) => b.count - a.count);

            let html = '<div style="display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto; padding-right: 5px;">';

            sorted.forEach(item => {
                const percent = ((item.count / results.length) * 100).toFixed(1);
                html += `
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 6px; border-left: 4px solid var(--primary); transition: transform 0.2s;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600; color: var(--text-primary); font-size: 14px;">${item.sector}</span>
                            <span style="font-family: 'Roboto Mono', monospace; font-weight: 700; color: var(--primary); font-size: 13px;">
                                ${item.count.toLocaleString()} (${percent}%)
                            </span>
                        </div>
                        <div style="height: 4px; background: var(--border); border-radius: 2px; margin-top: 8px; overflow: hidden;">
                            <div style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--info)); width: ${percent}%;"></div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            document.getElementById('sectorResults').innerHTML = html;
        }

        // Export results
        function exportResults() {
            const cachedData = localStorage.getItem('stock_sectors_data');
            if (!cachedData) {
                showNotification('⚠️ No data to export', 'warning');
                return;
            }

            const data = JSON.parse(cachedData);

            // Create CSV
            let csv = 'Symbol,Name,Sector\n';
            data.stocks.forEach(stock => {
                csv += `"${stock.symbol}","${stock.name.replace(/"/g, '""')}","${stock.sector}"\n`;
            });

            // Download
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `stock_sectors_${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('📥 Exported all stocks as CSV', 'success');
        }

        // Initialize instantly
        setTimeout(initInstantStockProcessing, 100);

        // Make functions globally available
        window.startInstantProcessing = startInstantProcessing;
        window.exportResults = exportResults;

    }); // Your existing closing });


</script>
<div id="root"></div>
</body>
</html>